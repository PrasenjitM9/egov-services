serviceMaps:
  serviceName: mSeva Event Notification
  mappings:
  - version: 1.0
    name: mSeva 
    description: Persists events into the table
    fromTopic: save-mseva-events
    isTransaction: true
    queryMaps:
    - query: INSERT INTO eg_men_events(tenantid, id, source, eventtype, name, postedby, referenceid, description, status, eventdetails, actions, recepient, createdby, createdtime, lastmodifiedby, lastmodifiedtime) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?);

      basePath: events.*
      jsonMaps:


      - jsonPath: $.events.*.tenantId

      - jsonPath: $.events.*.id

      - jsonPath: $.events.*.source

      - jsonPath: $.events.*.eventType
      
      - jsonPath: $.events.*.name
      
      - jsonPath: $.events.*.postedBy
      
      - jsonPath: $.events.*.referenceId

      - jsonPath: $.events.*.description

      - jsonPath: $.events.*.status

      - jsonPath: $.events.*.eventDetails
        type: JSON
        dbType: JSONB

      - jsonPath: $.events.*.actions
        type: JSON
        dbType: JSONB
      
      - jsonPath: $.events.*.recepient
        type: JSON
        dbType: JSONB

      - jsonPath: $.events.*.auditDetails.createdBy

      - jsonPath: $.events.*.auditDetails.createdTime

      - jsonPath: $.events.*.auditDetails.lastModifiedBy

      - jsonPath: $.events.*.auditDetails.lastModifiedTime
      
      
      
    - query: INSERT INTO eg_men_recepnt_event_registry(recepient, eventid) VALUES (?, ?);

      basePath: events.*.recepientEventMap.*
      jsonMaps:


      - jsonPath: $.events.*.recepientEventMap.*.recepient

      - jsonPath: $.events.*.recepientEventMap.*.eventId
      
      
      


  - version: 1.0
    name: mSeva
    description: Updates event details in the table
    fromTopic: update-mseva-events
    isTransaction: true
    queryMaps:
    - query: UPDATE eg_men_events SET description = ?, status = ?, name = ?, postedby = ?, eventdetails = ?, actions = ?, recepient = ? , lastmodifiedby = ?, lastmodifiedtime = ? WHERE id = ?;

      basePath: events.*
      jsonMaps:

      - jsonPath: $.events.*.description

      - jsonPath: $.events.*.status

      - jsonPath: $.events.*.name
      
      - jsonPath: $.events.*.postedBy
      
      - jsonPath: $.events.*.eventDetails
        type: JSON
        dbType: JSONB

      - jsonPath: $.events.*.actions
        type: JSON
        dbType: JSONB
      
      - jsonPath: $.events.*.recepient
        type: JSON
        dbType: JSONB

      - jsonPath: $.events.*.auditDetails.lastModifiedBy

      - jsonPath: $.events.*.auditDetails.lastModifiedTime
      
      - jsonPath: $.events.*.id
      
      

    - query: DELETE FROM eg_men_recepnt_event_registry WHERE eventid = ?;

      basePath: events.*
      jsonMaps:
      
      - jsonPath: $.events.*.id
      
      
      
    - query: INSERT INTO eg_men_recepnt_event_registry(recepient, eventid) VALUES (?, ?);

      basePath: events.*.recepientEventMap.*
      jsonMaps:


      - jsonPath: $.events.*.recepientEventMap.*.recepient

      - jsonPath: $.events.*.recepientEventMap.*.eventId  
      
      
      


  - version: 1.0
    name: mSeva 
    description: Persists user last login details
    fromTopic: mseva-events-llt
    isTransaction: true
    queryMaps:      
    - query: INSERT INTO eg_men_user_llt(userid, lastlogintime) VALUES (?, ?) ON CONFLICT (userid) DO UPDATE SET lastlogintime = ?;

      basePath: lastLoginDetails
      jsonMaps:


      - jsonPath: $.lastLoginDetails.userId

      - jsonPath: $.lastLoginDetails.lastLoginTime   
      
      - jsonPath: $.lastLoginDetails.lastLoginTime   




