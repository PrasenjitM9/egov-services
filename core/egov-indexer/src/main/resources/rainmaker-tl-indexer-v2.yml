ServiceMaps:
  serviceName: Trade License
  version: 1.0.0
  mappings:
  - topic: save-tl-tradelicense
    configKey: INDEX
    indexes:
    - name: tradelicense-v2
      type: licenses
      id: $.id, $.tenantId
      isBulk: true
      timeStampField: $.auditDetails.createdTime
      jsonPath: $.Licenses
      customJsonMapping:
        indexMapping: {"Data":{"tradelicenseId":"","tradelicense":"","@timestamp":""}}
        fieldMapping:
        - inJsonPath: $.id
          outJsonPath: $.Data.tradelicenseId
        - inJsonPath: $
          outJsonPath: $.Data.tradelicense
        - inJsonPath: $.auditDetails.createdTime
          outJsonPath: $.Data.@timestamp

  - topic: update-tl-tradelicense
    configKey: INDEX
    indexes:
    - name: tradelicense-v2
      type: licenses
      id: $.id, $.tenantid
      isBulk: true
      timeStampField: $.auditdetails.createdtime
      jsonPath: $.Licenses
      customJsonMapping:
        indexMapping: {"Data":{"tradelicenseId":"","tradelicense":"","@timestamp":""}}
        fieldMapping:
        - inJsonPath: $.id
          outJsonPath: $.Data.tradelicenseId
        - inJsonPath: $
          outJsonPath: $.Data.tradelicense
        - inJsonPath: $.auditdetails.createdtime
          outJsonPath: $.Data.@timestamp

  - topic: search-tl-tradelicense
    configKey: LEGACYINDEX
    indexes:
    - name: tradelicense-v2
      type: licenses
      id: $.id, $.tenantid
      isBulk: true
      timeStampField: $.auditdetails.createdtime
      jsonPath: $.Licenses
      customJsonMapping:
        indexMapping: {"Data":{"tradelicenseId":"","tradelicense":"","@timestamp":""}}
        fieldMapping:
        - inJsonPath: $.id
          outJsonPath: $.Data.tradelicenseId
        - inJsonPath: $
          outJsonPath: $.Data.tradelicense
        - inJsonPath: $.auditdetails.createdtime
          outJsonPath: $.Data.@timestamp
        externalUriMapping:
        - path: https://egov-micro-dev.egovernments.org/egov-location/location/v11/boundarys/_search
          queryParam: hierarchyTypeCode=REVENUE,boundaryType=locality,codes=$.tradelicensedetail.address.locality,tenantId=$.tenantid
          apiRequest: { "RequestInfo": { "apiId": "org.egov.pt", "ver": "1.0", "ts": 1502890899493, "action": "asd", "did": "4354648646", "key": "xyz", "msgId": "654654", "requesterId": "61", "authToken": "708e4ab7-ef7f-402e-838f-2d409b3e8fda", "userInfo": { "id": 73 } } }
          uriResponseMapping:
          - inJsonPath: $.TenantBoundary[0].boundary[0]
            outJsonPath: $.Data.tradelicense.tradelicensedetail.address.locality
